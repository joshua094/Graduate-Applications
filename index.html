<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Graduate Application Form</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .container {
            max-width: 600px;
        }
        .form-input {
            transition: all 0.3s ease;
            border-radius: 0.5rem;
        }
        .form-input:focus {
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.5);
            border-color: #3b82f6;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">

<div class="container bg-white rounded-2xl shadow-lg p-8 md:p-12">
    <div class="text-center mb-8">
        <h1 class="text-3xl md:text-4xl font-bold text-gray-800 mb-2">Graduate Application Form</h1>
        <p class="text-gray-500 text-lg">Enter your details and we'll save them to a Google Sheet.</p>
    </div>
    <form id="submissionForm" action="https://script.google.com/macros/s/AKfycbw9jxj3SNiyeD9T2sz9LQTr8tVJv0nVXSZ0K_Yk16l0fBJwVj_Q-TN_ghxkYAA0adCRzg/exec" method="post" class="space-y-6">
        <div>
            <label for="name" class="block text-sm font-medium text-gray-700 mb-1">Your Name</label>
            <input type="text" id="name" name="name" class="form-input mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Enter your full name" required>
        </div>
        <div>
            <label for="programType" class="block text-sm font-medium text-gray-700 mb-1">Program Type</label>
            <select id="programType" name="programType" class="form-input mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" required>
                <option value="" disabled selected>Select a program type</option>
                <option value="Masters">Masters</option>
                <option value="PhD">PhD</option>
            </select>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
                <label for="school1" class="block text-sm font-medium text-gray-700 mb-1">School 1 (Required)</label>
                <input type="text" id="school1" name="school1" class="form-input mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="e.g., Stanford University" onchange="getDeadline('school1', 'deadline1')" required>
            </div>
            <div>
                <label for="deadline1" class="block text-sm font-medium text-gray-700 mb-1">Deadline 1</label>
                <input type="date" id="deadline1" name="deadline1" class="form-input mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
            </div>
            <div>
                <label for="school2" class="block text-sm font-medium text-gray-700 mb-1">School 2</label>
                <input type="text" id="school2" name="school2" class="form-input mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="e.g., Harvard University" onchange="getDeadline('school2', 'deadline2')">
            </div>
            <div>
                <label for="deadline2" class="block text-sm font-medium text-gray-700 mb-1">Deadline 2</label>
                <input type="date" id="deadline2" name="deadline2" class="form-input mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
            </div>
            <div>
                <label for="school3" class="block text-sm font-medium text-gray-700 mb-1">School 3</label>
                <input type="text" id="school3" name="school3" class="form-input mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="e.g., MIT" onchange="getDeadline('school3', 'deadline3')">
            </div>
            <div>
                <label for="deadline3" class="block text-sm font-medium text-gray-700 mb-1">Deadline 3</label>
                <input type="date" id="deadline3" name="deadline3" class="form-input mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
            </div>
            <div>
                <label for="school4" class="block text-sm font-medium text-gray-700 mb-1">School 4</label>
                <input type="text" id="school4" name="school4" class="form-input mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="e.g., University of Cambridge" onchange="getDeadline('school4', 'deadline4')">
            </div>
            <div>
                <label for="deadline4" class="block text-sm font-medium text-gray-700 mb-1">Deadline 4</label>
                <input type="date" id="deadline4" name="deadline4" class="form-input mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
            </div>
            <div>
                <label for="school5" class="block text-sm font-medium text-gray-700 mb-1">School 5</label>
                <input type="text" id="school5" name="school5" class="form-input mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="e.g., Princeton University" onchange="getDeadline('school5', 'deadline5')">
            </div>
            <div>
                <label for="deadline5" class="block text-sm font-medium text-gray-700 mb-1">Deadline 5</label>
                <input type="date" id="deadline5" name="deadline5" class="form-input mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
            </div>
            <div>
                <label for="school6" class="block text-sm font-medium text-gray-700 mb-1">School 6</label>
                <input type="text" id="school6" name="school6" class_name="form-input mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="e.g., Yale University" onchange="getDeadline('school6', 'deadline6')">
            </div>
            <div>
                <label for="deadline6" class="block text-sm font-medium text-gray-700 mb-1">Deadline 6</label>
                <input type="date" id="deadline6" name="deadline6" class="form-input mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
            </div>
        </div>
        <div>
            <label for="email" class="block text-sm font-medium text-gray-700 mb-1">Email Address</label>
            <input type="email" id="email" name="email" class="form-input mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="e.g., jane.doe@email.com" required>
        </div>
        <div class="flex justify-center">
            <button type="submit" class="w-full sm:w-auto px-8 py-3 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-transform transform hover:-translate-y-1">
                Submit
            </button>
        </div>
    </form>

    <div id="messageBox" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center p-4 hidden">
        <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-sm text-center transform transition-all scale-100 opacity-100">
            <h3 id="messageTitle" class="text-xl font-bold mb-4"></h3>
            <p id="messageText" class="text-gray-600 mb-6"></p>
            <button id="closeMessageBox" class="px-6 py-2 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 transition-colors">
                OK
            </button>
        </div>
    </div>
</div>

<script>
    
    function showMessage(title, text) {
        const messageBox = document.getElementById('messageBox');
        const messageTitle = document.getElementById('messageTitle');
        const messageText = document.getElementById('messageText');

        messageTitle.textContent = title;
        messageText.textContent = text;
        if (title.toLowerCase().includes("success")) {
            messageTitle.classList.remove('text-red-600');
            messageTitle.classList.add('text-green-600');
        } else {
            messageTitle.classList.remove('text-green-600');
            messageTitle.classList.add('text-red-600');
        }
        messageBox.classList.remove('hidden');
    }

    async function getDeadline(schoolId, deadlineId) {
        const schoolName = document.getElementById(schoolId).value;
        const deadlineInput = document.getElementById(deadlineId);
        const programType = document.getElementById('programType').value;

        if (!schoolName || !programType) {
            deadlineInput.value = '';
            return;
        }

        let programDescription = '';
        if (programType === 'Masters') {
            programDescription = 'Master of Science in Engineering (MSE) in Material Science';
        } else if (programType === 'PhD') {
            programDescription = 'PhD in Material Science and Engineering';
        }

        const systemPrompt = "You are a helpful AI assistant. Find the graduate application deadline for the program at the university provided by the user. Respond with ONLY the date in YYYY-MM-DD format. If multiple deadlines exist, provide the earliest one. If no deadline can be found, respond with 'Not found'.";
        const userQuery = `Find the graduate application deadline for the ${programDescription} program at ${schoolName}.`;
        
        showMessage("Searching...", `Looking up the application deadline for the ${programDescription} program at ${schoolName}.`);

        const payload = {
            contents: [{ parts: [{ text: userQuery }] }],
            tools: [{ "google_search": {} }],
            systemInstruction: {
                parts: [{ text: systemPrompt }]
            },
        };

        try {
            const response = await fetch('/api/data', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            if (!response.ok) {
                throw new Error('API request failed');
            }

            const result = await response.json();
            const text = result?.candidates?.[0]?.content?.parts?.[0]?.text;

            if (text && text.match(/^\d{4}-\d{2}-\d{2}$/)) {
                deadlineInput.value = text;
                showMessage("Success", `Found a deadline for ${schoolName}.`);
            } else if (text === 'Not found') {
                deadlineInput.value = '';
                showMessage("No Deadline Found", `I couldn't find a specific deadline for ${schoolName}.`);
            } else {
                 showMessage("Error", "The AI response was not in the expected format. Please try a different query.");
            }
        } catch (error) {
            showMessage("Error", `Failed to get deadline: ${error.message}`);
        }
    }

    document.addEventListener('DOMContentLoaded', () => {
        const form = document.getElementById('submissionForm');
        const closeMessageBoxButton = document.getElementById('closeMessageBox');

        form.addEventListener('submit', async (e) => {
            e.preventDefault();

            const formData = new FormData(form);
            const actionUrl = form.action;

            if (!actionUrl || actionUrl.includes('[YOUR_APPS_SCRIPT_URL_HERE]')) {
                showMessage("Error", "Please follow the instructions and add your Apps Script URL to the form's action attribute.");
                return;
            }

            try {
                const response = await fetch(actionUrl, {
                    method: 'POST',
                    body: formData
                });

                if (response.ok) {
                    const result = await response.text();
                    if (result.includes("Success")) {
                        showMessage("Success!", "Your information has been saved to the Google Sheet.");
                        form.reset();
                    } else {
                        showMessage("Error", "There was an issue saving your data. Please try again.");
                    }
                } else {
                    showMessage("Error", "Failed to connect to the Apps Script. Please check the URL.");
                }
            } catch (error) {
                showMessage("Error", `An unexpected error occurred: ${error.message}`);
            }
        });

        closeMessageBoxButton.addEventListener('click', () => {
            document.getElementById('messageBox').classList.add('hidden');
        });
    });
</script>

</body>
</html>